{"version":3,"file":"vorarbeiter.umd.js","sources":["../es/index.js"],"sourcesContent":["export var ServiceType;\n(function (ServiceType) {\n    ServiceType[\"Shared\"] = \"shared\";\n    ServiceType[\"Transient\"] = \"transient\";\n    ServiceType[\"Scoped\"] = \"scoped\";\n})(ServiceType || (ServiceType = {}));\nexport class ServiceContainerImpl {\n    constructor(spec) {\n        this.spec = spec;\n        this.services = new Map();\n        this.loading = new Set();\n        let resolveService = this.resolveService.bind(this);\n        this.spec.middlewares.forEach(mw => {\n            resolveService = mw(resolveService);\n        });\n        this.resolveService = resolveService;\n    }\n    get(id) {\n        return this.resolveService(id);\n    }\n    resolveService(id) {\n        if (!this.spec.services.has(id)) {\n            throw new UnknownServiceError(id);\n        }\n        const definition = this.spec.services.get(id);\n        // eslint-disable-next-line default-case\n        switch (definition.type.name) {\n            case ServiceType.Transient:\n                return this.resolveServiceTransient(id);\n            case ServiceType.Scoped:\n                return this.resolveServiceScoped(id);\n            case ServiceType.Shared:\n                return this.resolveServiceShared(id);\n        }\n    }\n    resolveServiceShared(id) {\n        if (this.services.has(id)) {\n            return this.services.get(id);\n        }\n        const service = this.createService(id);\n        this.services.set(id, service);\n        this.executeInjection(id, service);\n        return service;\n    }\n    resolveServiceTransient(id) {\n        const service = this.createService(id);\n        this.executeInjection(id, service);\n        return service;\n    }\n    resolveServiceScoped(id) {\n        const ctx = this.resolveContext(id);\n        if (!this.services.has(id)) {\n            this.services.set(id, new WeakMap());\n        }\n        const ctxMap = this.services.get(id);\n        if (ctxMap.has(ctx)) {\n            return ctxMap.get(ctx);\n        }\n        const service = this.createService(id);\n        ctxMap.set(ctx, service);\n        this.executeInjection(id, service);\n        return service;\n    }\n    has(id) {\n        return this.services.has(id);\n    }\n    createService(id) {\n        if (this.loading.has(id)) {\n            throw new ServiceCircularReferenceError(id, [...this.loading.values(), id]);\n        }\n        const definition = this.spec.services.get(id);\n        const { factory } = definition;\n        this.loading.add(id);\n        const service = typeof factory === \"function\" ? factory(this) : factory.create(this);\n        this.loading.delete(id);\n        return service;\n    }\n    executeInjection(id, service) {\n        const definition = this.spec.services.get(id);\n        const { injector } = definition;\n        if (!injector) {\n            return;\n        }\n        if (typeof injector === \"function\") {\n            injector(service, this);\n            return;\n        }\n        injector.inject(service, this);\n    }\n    resolveContext(id) {\n        const definition = this.spec.services.get(id);\n        const { contextResolver } = definition.type;\n        return typeof contextResolver === \"function\" ? contextResolver(this) : contextResolver.resolveContext(this);\n    }\n}\nexport const createServiceContainer = (spec) => new ServiceContainerImpl(spec);\nexport class ServiceDefinitionBuilderImpl {\n    constructor(factory) {\n        this.factory = factory;\n        this.shared();\n    }\n    shared() {\n        this.type = { name: ServiceType.Shared };\n        return this;\n    }\n    transient() {\n        this.type = { name: ServiceType.Transient };\n        return this;\n    }\n    scoped(contextResolver) {\n        this.type = { name: ServiceType.Scoped, contextResolver };\n        return this;\n    }\n    withInjector(injector) {\n        this.injector = injector;\n        return this;\n    }\n    getServiceDefinition() {\n        return {\n            type: this.type,\n            factory: this.factory,\n            injector: this.injector\n        };\n    }\n}\nexport class ServiceSpecBuilderImpl {\n    constructor() {\n        this.defBuilders = new Map();\n        this.middlewares = [];\n    }\n    set(id, factory) {\n        const definitionBuilder = new ServiceDefinitionBuilderImpl(factory);\n        this.defBuilders.set(id, definitionBuilder);\n        return definitionBuilder;\n    }\n    addMiddleware(...middlewares) {\n        this.middlewares.push(...middlewares);\n        return this;\n    }\n    getServiceSpec() {\n        const services = new Map();\n        this.defBuilders.forEach((definitionBuilder, id) => {\n            services.set(id, definitionBuilder.getServiceDefinition());\n        });\n        return {\n            services,\n            middlewares: this.middlewares\n        };\n    }\n}\nexport const createServiceSpecBuilder = () => new ServiceSpecBuilderImpl();\nexport class UnknownServiceError extends Error {\n    constructor(id) {\n        super(`unknown service \"${String(id)}\"`);\n        this.id = id;\n        this.name = \"UnknownServiceError\";\n    }\n}\nexport class ServiceCircularReferenceError extends Error {\n    constructor(id, referenceChain) {\n        super(`circular dependency detected: ${referenceChain.map(String).join(\" -> \")}`);\n        this.id = id;\n        this.referenceChain = referenceChain;\n        this.name = \"ServiceCircularReferenceError\";\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["ServiceType"],"mappings":"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"}