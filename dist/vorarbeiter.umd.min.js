!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vorarbeiter={})}(this,(function(e){"use strict";class t{constructor(e){this.spec=e,this.services=new Map,this.loading=new Set;let t=this.resolveService.bind(this);this.spec.middlewares.forEach((e=>{t=e(t)})),this.resolveService=t}get(e){return this.resolveService(e)}resolveService(e){var t;if(!this.spec.services.has(e))throw new c(e);return null!==(t=this.retrieveService(e))&&void 0!==t?t:this.createService(e)}has(e){return this.services.has(e)}createService(e){if(this.loading.has(e))throw new o(e,[...this.loading.values(),e]);const t=this.spec.services.get(e),{factory:r,injector:s}=t;this.loading.add(e);const i="function"==typeof r?r(this):r.create(this);return this.loading.delete(e),this.storeService(e,i),s&&("function"==typeof s?s(i,this):s.inject(i,this)),i}storeService(e,t){const r=this.resolveContext(e);this.services.has(e)||this.services.set(e,new WeakMap),this.services.get(e).set(r,t)}retrieveService(e){var t;const r=this.resolveContext(e);return null===(t=this.services.get(e))||void 0===t?void 0:t.get(r)}resolveContext(e){const t=this.spec.services.get(e),{contextResolver:r}=t;return"function"==typeof r?r(this):r.resolveContext(this)}}class r{constructor(e){this.factory=e,this.contextResolver=new i}shared(){return this.scoped(new i),this}transient(){return this.scoped(new n),this}scoped(e){return this.contextResolver=e,this}withInjector(e){return this.injector=e,this}getServiceDefinition(){return{factory:this.factory,contextResolver:this.contextResolver,injector:this.injector}}}class s{constructor(){this.defBuilders=new Map,this.middlewares=[]}set(e,t){const s=new r(t);return this.defBuilders.set(e,s),s}addMiddleware(...e){return this.middlewares.push(...e),this}getServiceSpec(){const e=new Map;return this.defBuilders.forEach(((t,r)=>{e.set(r,t.getServiceDefinition())})),{services:e,middlewares:this.middlewares}}}class i{constructor(){this.context=Object.create(null)}resolveContext(e){return this.context}}class n{resolveContext(e){return Object.create(null)}}class c extends Error{constructor(e){super(`unknown service "${String(e)}"`),this.id=e,this.name="UnknownServiceError"}}class o extends Error{constructor(e,t){super(`circular dependency detected: ${t.map(String).join(" -> ")}`),this.id=e,this.referenceChain=t,this.name="ServiceCircularReferenceError"}}e.ServiceCircularReferenceError=o,e.ServiceContainerImpl=t,e.ServiceDefinitionBuilderImpl=r,e.ServiceSpecBuilderImpl=s,e.SharedContextResolver=i,e.TransientContextResolver=n,e.UnknownServiceError=c,e.createServiceContainer=e=>new t(e),e.createServiceSpecBuilder=()=>new s,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vorarbeiter.umd.min.js.map
