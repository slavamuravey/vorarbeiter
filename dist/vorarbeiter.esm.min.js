class e{constructor(e){this.spec=e,this.services=new Map,this.loading=new Set}get(e){var t;if(!this.spec.has(e))throw new o(e);return null!==(t=this.retrieveService(e))&&void 0!==t?t:this.createService(e)}has(e){return this.services.has(e)}createService(e){if(this.loading.has(e))throw new h(e,[...this.loading.values(),e]);const t=this.spec.get(e),{factory:s,injector:r}=t;this.loading.add(e);const i="function"==typeof s?s(this):s.create(this);return this.loading.delete(e),this.storeService(e,i),r&&("function"==typeof r?r(i,this):r.inject(i,this)),i}storeService(e,t){const s=this.resolveContext(e);this.services.has(e)||this.services.set(e,new WeakMap),this.services.get(e).set(s,t)}retrieveService(e){var t;const s=this.resolveContext(e);return null===(t=this.services.get(e))||void 0===t?void 0:t.get(s)}resolveContext(e){const t=this.spec.get(e),{contextResolver:s}=t;return"function"==typeof s?s(this):s.resolveContext(this)}}const t=t=>new e(t);class s{constructor(e){this.factory=e,this.contextResolver=new n}shared(){return this.scoped(new n),this}transient(){return this.scoped(new c),this}scoped(e){return this.contextResolver=e,this}withInjector(e){return this.injector=e,this}getServiceDefinition(){return{factory:this.factory,contextResolver:this.contextResolver,injector:this.injector}}}class r{constructor(){this.defBuilders=new Map}set(e,t){const r=new s(t);return this.defBuilders.set(e,r),r}getServiceSpec(){const e=new Map;return this.defBuilders.forEach(((t,s)=>{e.set(s,t.getServiceDefinition())})),e}}const i=()=>new r;class n{constructor(){this.context=Object.create(null)}resolveContext(e){return this.context}}class c{resolveContext(e){return Object.create(null)}}class o extends Error{constructor(e){super(`unknown service "${e}"`),this.id=e,this.name="UnknownServiceError"}}class h extends Error{constructor(e,t){super(`circular dependency detected: ${t.join(" -> ")}`),this.id=e,this.referenceChain=t,this.name="ServiceCircularReferenceError"}}export{h as ServiceCircularReferenceError,e as ServiceContainerImpl,s as ServiceDefinitionBuilderImpl,r as ServiceSpecBuilderImpl,n as SharedContextResolver,c as TransientContextResolver,o as UnknownServiceError,t as createServiceContainer,i as createServiceSpecBuilder};
//# sourceMappingURL=vorarbeiter.esm.min.js.map
