"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ServiceType=void 0,(e=exports.ServiceType||(exports.ServiceType={})).Shared="shared",e.Transient="transient",e.Scoped="scoped";class t{constructor(e){this.spec=e,this.services=new Map,this.loading=new Set;let t=this.resolveService.bind(this);this.spec.middlewares.forEach((e=>{t=e(t)})),this.resolveService=t}get(e){return this.resolveService(e)}resolveService(e){if(!this.spec.services.has(e))throw new i(e);switch(this.spec.services.get(e).type.name){case exports.ServiceType.Transient:return this.resolveServiceTransient(e);case exports.ServiceType.Scoped:return this.resolveServiceScoped(e);case exports.ServiceType.Shared:return this.resolveServiceShared(e)}}resolveServiceShared(e){if(this.services.has(e))return this.services.get(e);const t=this.createService(e);return this.services.set(e,t),this.executeInjection(e,t),t}resolveServiceTransient(e){const t=this.createService(e);return this.executeInjection(e,t),t}resolveServiceScoped(e){const t=this.resolveContext(e);this.services.has(e)||this.services.set(e,new WeakMap);const r=this.services.get(e);if(r.has(t))return r.get(t);const s=this.createService(e);return r.set(t,s),this.executeInjection(e,s),s}has(e){return this.services.has(e)}createService(e){if(this.loading.has(e))throw new c(e,[...this.loading.values(),e]);const t=this.spec.services.get(e),{factory:r}=t;this.loading.add(e);const s="function"==typeof r?r(this):r.create(this);return this.loading.delete(e),s}executeInjection(e,t){const r=this.spec.services.get(e),{injector:s}=r;s&&("function"==typeof s?s(t,this):s.inject(t,this))}resolveContext(e){const t=this.spec.services.get(e),{contextResolver:r}=t.type;return"function"==typeof r?r(this):r.resolveContext(this)}}class r{constructor(e){this.factory=e,this.shared()}shared(){return this.type={name:exports.ServiceType.Shared},this}transient(){return this.type={name:exports.ServiceType.Transient},this}scoped(e){return this.type={name:exports.ServiceType.Scoped,contextResolver:e},this}withInjector(e){return this.injector=e,this}getServiceDefinition(){return{type:this.type,factory:this.factory,injector:this.injector}}}class s{constructor(){this.defBuilders=new Map,this.middlewares=[]}set(e,t){const s=new r(t);return this.defBuilders.set(e,s),s}addMiddleware(...e){return this.middlewares.push(...e),this}getServiceSpec(){const e=new Map;return this.defBuilders.forEach(((t,r)=>{e.set(r,t.getServiceDefinition())})),{services:e,middlewares:this.middlewares}}}class i extends Error{constructor(e){super(`unknown service "${String(e)}"`),this.id=e,this.name="UnknownServiceError"}}class c extends Error{constructor(e,t){super(`circular dependency detected: ${t.map(String).join(" -> ")}`),this.id=e,this.referenceChain=t,this.name="ServiceCircularReferenceError"}}exports.ServiceCircularReferenceError=c,exports.ServiceContainerImpl=t,exports.ServiceDefinitionBuilderImpl=r,exports.ServiceSpecBuilderImpl=s,exports.UnknownServiceError=i,exports.createServiceContainer=e=>new t(e),exports.createServiceSpecBuilder=()=>new s;
//# sourceMappingURL=vorarbeiter.cjs.min.js.map
